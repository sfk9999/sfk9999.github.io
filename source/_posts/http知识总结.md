---
title: http知识总结
date: 2018-01-30 09:09:25
toc: true
tags:
    - http
---
#### 1.HTTP协议的特点：
1. 支持客户/服务器模式。
2. 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有GET、HEAD、POST。每种方法规定了客户与服务器联系的类型不同。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
3. 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
4. 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
5. 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快
6. 一般格式: http://<主机>:<端口>/<路径>

<!--more-->

#### 2.http状态码
##### 2.1 http状态码分为五大类
- 100-199: 用于指定客户端应相应的某些动作
- 200-299：用于表示请求成功
- 300-399：用于已移除的文件并且常被包含在定位头信息中指定新的地址信息
- 400-499：用于指出客户端的错误
- 500-599：用于支持服务器错误

##### 2.2 具体状态码
- 200：请求成功，一般用于相应的GET和POST请求。
- 201：请求成功，且服务器创建了新的资源
- 202：服务器已接受请求，但尚未处理
- 204：无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文
- 301：永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替
- 302：临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI
- 303：告知客户端应该用另一个URL来获取资源
- 304：未修改。所请求的资源未修改，客户机缓存的版本是最新的, 客户机应该继续使用它
- 400：请求语法错误，服务器无法理解
- 401：请求未授权
- 403：服务器理解请求客户端的请求，但是拒绝执行此请求。
- 404：未找到资源
- 500：服务器内部错误，无法完成请求
- 503：由于超载或系统维护，服务器暂时的无法处理客户端的请求。

#### 3.HTTP中GET和POST的区别
1. 方式
    - GET请求的数据会附在URL之后(就是把数据放置在HTTP协议头中)，以?分隔URL和传输数据，参数之间以&相连。如果数据是英文字母/数字，原样发送，如果是空格，转换为+，如果是中文/其他字符，则直接把字符串用BASE64加密。
    - POST把提交的数据则放置在HTTP包的包体中
2. 数据量 
    - GET方法使用URL传递参数，对所发送的数量有限制
    - POST一般用于修改服务器上的资源，对所发送信息的数量无限制
3. 安全
    - POST的安全性比GET的安全性高。
4. 缓存
    - GET能被缓存，POST不能缓存

#### 4. 请求报文
![image](http知识总结/1.png)
- 一个HTTP请求报文由请求行、请求头部、请求正文3部分组成
1. 请求行
    - 由3部分组成：请求方法（第6节）、URL以及协议版本，之间由空格分隔
        - 协议版本：HTTP/主版本号.次版本号
2. 请求头部
    - 请求头部为请求报文添加了一些附加信息，由“名/值”对组成，每行一对，名和值之间使用冒号分隔
        - Host:接受请求的服务器地址，可以是IP:端口号，也可以是域名
        - User-Agent:发送请求的应用程序名称
        - Connection:指定与连接相关的属性，如Connection:Keep-Alive
        - Accept-Charset:通知服务端可以发送的编码格式
        - Accept-Encoding:通知服务端可以发送的数据压缩格式
        - Accept-Language:通知服务端可以发送的语言
    - 请求头部的最后会有一个空行，表示请求头部结束，接下来为请求正文
3. 请求头部(可选)

#### 5. 响应报文
![image](http知识总结/2.png)
- HTTP响应报文主要由状态行、响应头部、响应正文3部分组成
1. 状态行：
    - 由3部分组成：协议版本，状态码，状态码描述，之间由空格分隔
        - 状态代码为3位数字（404）
    - 响应头部
        - 与请求头部类似
            - Server：服务器应用程序软件的名称和版本
            - Content-Type：响应正文的类型（是图片还是二进制字符串）
            - Content-Length：响应正文长度
            - Content-Charset：响应正文使用的编码
            - Content-Encoding：响应正文使用的数据压缩格式
            - Content-Language：响应正文使用的语言

#### 6. 请求方法
- http请求由三部分组成：请求行，消息报文，请求正文。
- 请求方法：
    - GET：请求指定的页面信息，并返回实体主题
    - POST: 向指定资源提交数据进行处理请求。数据被包含在请求体中。POST请求可能会导致新的资源的建立和已有资源的修改。
    - HEAD: 请求获取由Request-URI所标识的资源的响应消息报头
    - PUT:请求服务器存储一个资源，并用Request-URI作为其标识
    - DELETE:请求服务器删除指定的页面。
    - TRACE:请求服务器回送收到的请求信息，主要用于测试或诊断
    - OPTIONS:请求查询服务器的性能，或者查询与资源相关的选项和需求

#### 7. 用户输入域名并点击确认后发生的事情
1. 浏览器分析链接指向页面的URL；
2. 浏览器向DNS请求URL的IP地址；
3. DNS解析出URL的IP地址并返回；
4. 浏览器与服务器建立TCP连接；
5. 浏览器发出取文件命令：GET
6. 服务器给出响应，把指定文件发送给浏览器；
7. 释放TCP连接；
8. 浏览器显示页面中所有文本

#### 8. HTTPS
- HTTPS是最流行的HTTP安全形式
- 使用HTTPS时，所有的HTTP请求和响应数据在发送到网络之前，都要进行加密。可以使用SSL或者TLS。
- HTTTPS多了一个SSL安全参数握手，该过程中，客户端和服务器需要完成以下工作：
    1. 交换协议版本号；
    2. 选择一个双方都了解的密码；
    3. 对两端身份认证；
    4. 生成临时的会话密钥，以便加密信道。

##### 8.1 http与https的区别
- 端口：HTTP端口是80。HTTPS端口是443。
- 连接方式：http的连接很简单，是无状态的，超文本传输协议，信息是明文传输；HTTPS协议是是可以进行加密传输、身份认证的网络协议。

#### 9. HTTP1.1 和HTTP1.0 的区别
- http 1.0 对于每个连接都得建立一次连接, 一次只能传送一个请求和响应, 请求就会关闭, http1.0没有Host字段；而http1.1 在同一个连接中可以传送多个请求和响应, 多个请求可以重叠和同时进行, http1.1必须有host字段
- http1.1中引入了ETag头, 它的值entity tag可以用来唯一的描述一个资源. 请求消息中可以使用If-None-Match头域来匹配资源的entitytag是否有变化 
- http1.1 新增了Cache-Control头域(消息请求和响应请求都可以使用), 它支持一个可扩展的指令子集
- http1.0中只定义了16个状态响应码, 对错误或警告的提示不够具体. http1.1引入了一个Warning头域, 增加对错误或警告信息的描述. 且新增了24个状态响应码

#### 10. TCP
##### 10.1 主要特点
- TCP是TCP/IP体系中非常复杂的一个协议，下面介绍其主要特点：
    - TCP是面向连接的运输层协议。就是说，应用程序在使用TCP协议之前，必须先建立TCP连接。在数据传送完毕后，必须释放已经建立的TCP连接
    - TCP连接只能是点对点的，也就是一对一，不同于UDP的一对多，多对多。
    - TCP是可靠传输，通过TCP传输的数据，无差错、不丢失、不重复、并且按照发送顺序到达
    - TCP是面向字节流的，不像UDP是面向报文的。TCP把应用程序交下来的数据看成一连串的无结构的字节流。TCP并不知道所传送的字节流的含义
- TCP对于发送数据进行跟踪，这种数据管理需要协议有以下两个关键功能：
    - 可靠性：保证数据确实到达目的地。如果未到达，能够发现并重传。
    - 数据流控：管理数据的发送速率，以使接受设备不至于过载。

##### 10.2 滑动窗口确认机制
- TCP将独立的字节数据当作流来处理，为了提高速度，TCP将数据流分成片段，片段内的所有字节都是一起发送和接受的，因此也是一起确认的。
- TCP的流量控制机制：A和B进行通信，B就会定期给A发送一条限制参数，制约A一次发送的最大消息数量，从而控制A的数据流。
- 数据状态可以分为以下四类
    1. 已发送已确认：数据流中已经发送成功并得到确认的数据
    2. 已发送但未确认：已经发送但是未得到确认的字节，发送方在确认之前，不会认为这些数据已经被处理
    3. 未发送但已准备：发送方未将数据发送，但接收方已经确认自己有足够的空间，发送方会立即尝试发送
    4. 未发送也未准备：这部分数据还不允许发送
- 整个传输过程的关键操作在于接收方运行发送方一次能容纳的未确认的字节数，称为发送窗口。该窗口决定了发送方允许传送的字节数，是2类和3类字节数之和。可用窗口和发送窗口不同，可用窗口是发送方仍被允许发送的数据量，也就是3类字节数。

##### 10.3 TCP连接
- TCP连接过程中解决以下三个问题：
    1．要使每一方能够确认对方的存在；
    2．要允许双方协商一些参数，比如最大窗口值，时间戳选项等；
    3．能够对运输实体资源进行分配。
- 三次握手：
    - 第一次握手：A的TCP客户进程也是首先创建传输控制模块TCB，然后向B发出连接请求报文段，这时首部中的同步位SYN=1，同时选择一个初始序号seq=x。TCP规定，SYN报文不能携带数据。这时客户进程进入SYN-SENT状态。
    - 第二次握手：B收到连接请求报文后，如果同意建立连接，则向A发送确认，将SYN和ACK位都置为1，确认号是ack=x+1，同时也为自己选择一个初始序号seq=y。这个报文同样不能携带数据。这时服务区进程进入SYN-RCVD状态。
    - 第三次握手：A接收B的确认后，还要向B给出确认，将ACK置为1。该报文可以携带数据。这时A进入ESTABLISHED状态，B接收A的确认后，也进入ESTABLISHED状态。
- 为什么要第三次握手：
    - 为了防止已经失效的连接请求报文段突然又传送给了B

##### 10.4 TCP释放
- 四次挥手
    - B接收到连接释放报文段后发出确认，然后B就进入COLSE-WAIT状态。这个TCP服务进程就通知应用层，A已经没有数据要发送了，但是B如果还要发送数据，A仍然要接收，这时TCP连接处于半关闭状态。
    - A接收到B的确认后，就进入FIN-WAIT-2状态，等待B发出的连接释放报文。
    - 如果B已经没有数据发给A，就可以通过TCP释放连接了，将FIN置为1，这时B进入LAST-ACK状态，等待A的确认。
    - A收到B的连接释放报文后，必须对此发出确认，然后进入TIME-WAIT状态。注意，这个时候TCP还没有被释放掉，必须经过时间等待计时器设置的时间2MSL后，A才进入CLOSED状态。时间MSL叫做最长报文段寿命，建议设为2分钟。


