---
title: js代码规范
date: 2018-04-01 19:41:11
toc: true
tags:
    - JavaScript
---

代码规范的目标是使JavaScript代码风格保持一致，容易被理解和被维护。本文主要是对百度FECS规范中的JS部分进行提取
<!--more-->

### 1. 代码风格
#### 1.1 结构
##### 1.1.1 缩进
- [强制] [RULE003] 使用 4 个空格做为一个缩进层级，不允许使用 2 个空格 或 tab 字符。
- [强制] switch 下的 case 和 default 必须增加一个缩进层级。

##### 1.1.2 空格
- [强制] [RULE005] 二元运算符两侧必须有一个空格，一元运算符与操作对象之间不允许有空格。
    ```
    var a = !arr.length;
    ```
- [强制] [RULE006] 用作代码块起始的左花括号 { 前必须有一个空格
- [强制] [RULE007] if / else / for / while / function / switch / do / try / catch / finally 关键字后，必须有一个空格。
    ```
    if (condition) {
    }
    ```
- [强制] [RULE008] 在对象创建时，属性中的 : 之后必须有空格，: 之前不允许有空格。
    ```
    var obj = {
        a: 1
    };
    ```
- [强制] [RULE009] 函数声明、具名函数表达式、函数调用中，函数名和 ( 之间不允许有空格。
    ```
    function funcName() {
    }
    ```
- [强制] , 和 ; 前不允许有空格。
- [强制] 在函数调用、函数声明、括号表达式、属性访问、if / for / while / switch / catch 等语句中，() 和 [] 内紧贴括号部分不允许有空格
    ```
    callFunc(param1, param2);
    ```
- [强制] [RULE012] 单行声明的数组与对象，如果包含元素，{} 和 [] 内紧贴括号部分不允许包含空格。
    ```
    var arr2 = [1, 2, 3];
    ```
- [强制] [RULE013] 行尾不得有多余的空格。

##### 1.1.3 换行
- [强制] 每个独立语句结束后必须换行
- [强制] [RULE015] 每行不得超过 120 个字符。
- [强制] 运算符处换行时，运算符必须在新行的行首。
- [强制] [RULE017] 在函数声明、函数表达式、函数调用、对象创建、数组创建、for语句等场景中，不允许在 , 或 ; 前换行。
- [建议] 对于 if...else... 、 try...catch...finally 等语句，推荐使用在 } 号后添加一个换行 的风格，使代码层次结构更清晰，阅读性更好。

##### 1.1.4 语句
- [强制] [RULE021] 不得省略语句结束的分号
- [强制] [RULE022] 在 if / else / for / do / while 语句中，即使只有一行，也不得省略块 {...}。
- [强制] [RULE023] 函数定义结束不允许添加分号。(函数表达式不允许省略)
- [强制] [RULE024] IIFE 必须在函数表达式外添加 (，非 IIFE 不得在函数表达式外添加 ( 。

#### 1.2 命名
- Canmel:theBells
- Pascal:TextNode

- [强制] 变量 使用 Camel命名法 。
- [强制] 常量 使用 全部字母大写，单词间下划线分隔 的命名方式。
- [强制] 函数 使用 Camel命名法 
- [强制] 函数的 参数 使用 Camel命名法 。
- [强制] [RULE029] 类 使用 Pascal命名法 。
- [强制] [RULE025] 类的 方法 / 属性 使用 Camel命名法 。
- [强制] 枚举变量 使用 Pascal命名法 ，枚举的属性 使用 全部字母大写，单词间下划线分隔 的命名方式。
- [强制] 命名空间 使用 Camel命名法 。
- [强制] 由多个单词组成的缩写词，在命名中，根据当前命名法和出现的位置，所有字母的大小写与首字母的大小写保持一致。
- [强制] 类名 使用 名词 。
- [建议] 函数名 使用 动宾短语 。
- [建议] boolean 类型的变量使用 is 或 has 开头。
- [建议] Promise对象 用 动宾短语的进行时 表达。

#### 1.3 注释
##### 1.3.1 单行注释
- [强制] [RULE038] 必须独占一行。// 后跟一个空格，缩进与下一行被注释说明的代码一致。

##### 1.3.2 多行注释
- [建议] 避免使用 /*...*/ 这样的多行注释。有多行注释内容时，使用多个单行注释。

##### 1.3.3 文档化注释
- [强制] 为了便于代码阅读和自文档化，以下内容必须包含以 /**...*/ 形式的块注释中。
    ```
    文件
    namespace
    类
    函数或方法
    类属性
    事件
    全局变量
    常量
    AMD 模块
    ```
- [强制] 文档注释前必须空一行
- [建议] 自文档化的文档说明 what，而不是 how。

##### 1.3.4 类型定义
- [强制] 类型定义都是以 { 开始, 以 } 结束。
- [强制] 对于基本类型 {string}, {number}, {boolean}，首字母必须小写。


##### 1.3.5 文件注释
- [强制] 文件顶部必须包含文件注释，用 @file 标识文件说明。
    ```
    /**
     * @file Describe the file
     */
    ```
- [建议] 文件注释中可以用 @author 标识开发者信息。
    ```
    /**
     * @file Describe the file
     * @author author-name(mail-name@domain.com)
     *         author-name2(mail-name2@domain.com)
     */
    ```

##### 1.3.6 命名空间注释
- [建议] 命名空间使用 @namespace 标识。

##### 1.3.7 类注释
- [建议] 使用 @class 标记类或构造函数
- [建议] 使用 @extends 标记类的继承信息
- [强制] 使用包装方式扩展类成员时， 必须通过 @lends 进行重新指向
- [强制] 类的属性或方法等成员信息使用 @public / @protected / @private 中的任意一个，指明可访问性。

##### 1.3.8 函数/方法注释
- [强制] 函数/方法注释必须包含函数说明，有参数和返回值时必须使用注释标识。
- [强制] 参数和返回值注释必须包含类型信息和说明。
- [建议] 当函数是内部函数，外部不可访问时，可以使用 @inner 标识。
    ```
    /**
     * 函数描述
     *
     * @param {string} p1 参数1的说明
     * @param {string} p2 参数2的说明，比较长
     *     那就换行了.
     * @param {number=} p3 参数3的说明（可选）
     * @return {Object} 返回值描述
     */
    function foo(p1, p2, p3) {
        var p3 = p3 || 10;
        return {
            p1: p1,
            p2: p2,
            p3: p3
        };
    }
    ```
- [强制] 对 Object 中各项的描述， 必须使用 @param 标识。

##### 1.3.9 事件注释
- [强制] 必须使用 @event 标识事件，事件参数的标识与方法描述的参数标识相同。
    ```
    /**
     * 值变更时触发
     *
     * @event
     * @param {Object} e e描述
     * @param {string} e.before before描述
     * @param {string} e.after after描述
     */
    onchange: function (e) {
    }
    ```
- [强制] 在会广播事件的函数前使用 @fires 标识广播的事件，在广播事件代码前使用 @event 标识事件。
- [建议] 对于事件对象的注释，使用 @param 标识，生成文档时可读性更好。

##### 1.3.10 常量注释
- [强制] 常量必须使用 @const 标记，并包含说明和类型信息

##### 1.3.11 复杂类型注释
- [建议] 对于类型未定义的复杂结构的注释，可以使用 @typedef 标识来定义。

##### 1.3.12 AMD 模块注释
- [强制] AMD 模块使用 @module 或 @exports 标识。
- [强制] 对于已使用 @module 标识为 AMD模块 的引用，在 namepaths 中必须增加 module: 作前缀。
- [建议] 对于类定义的模块，可以使用 @alias 标识构建函数。
- [建议] 多模块定义时，可以使用 @exports 标识各个模块。
- [建议] 对于 exports 为 Object 的模块，可以使用 @namespace 标识。
- [建议] 对于 exports 为类名的模块，使用 @class 和 @exports 标识。

##### 1.3.13 细节注释
- [建议] 细节注释遵循单行注释的格式。说明必须换行时，每行是一个单行注释的起始。
- [强制] 有时我们会使用一些特殊标记进行说明。特殊标记必须使用单行注释的形式。下面列举了一些常用标记
    - TODO: 有功能待实现。此时需要对将要实现的功能进行简单说明。
    - FIXME: 该处代码运行没问题，但可能由于时间赶或者其他原因，需要修正。此时需要对如何修正进行简单说明
    - HACK: 为修正某些问题而写的不太好或者使用了某些诡异手段的代码。此时需要对思路或诡异手段进行描述。
    - XXX: 该处存在陷阱。此时需要对陷阱进行描述。

### 2 语言特性
#### 2.1 变量
- [强制] [RULE070] 变量在使用前必须通过 var 定义。
- [强制] [RULE071] 每个 var 只能声明一个变量。
- [强制] [RULE072] 变量必须 即用即声明 ，不得在函数或其它形式的代码块起始位置统一声明所有变量

#### 2.2 条件
- [强制] [RULE073] 在 Equality Expression 中使用类型严格的 === 。仅当判断 null 或 undefined 时，允许使用 == null 。

#### 2.3 循环
- [建议] 不要在循环体中包含函数表达式，事先将函数提取到循环体外。
    ```
    // good
    function clicker() {
        // ......
    }
    
    for (var i = 0, len = elements.length; i < len; i++) {
        var element = elements[i];
        addListener(element, 'click', clicker);
    }
    ```
- [建议] 对循环内多次使用的不变值，在循环外用变量缓存
- [建议] 对有序集合进行遍历时，缓存 length 。
- [建议] 对有序集合进行顺序无关的遍历时，使用逆序遍历。
    ```
    var len = elements.length;
    while (len--) {
        var element = elements[len];
        // ......
    }
    ```

#### 2.4 类型
##### 2.4.2 类型转换
- [建议] 转换成 string 时，使用 + '' 。
    ```
    num + '';
    ```
- [建议] 转换成 number 时，通常使用 +
    ```
    +num;
    ```
- [建议] string 转换成 number ，要转换的字符串结尾包含非数字并期望忽略时，使用 parseInt。
- [强制] [RULE086] 使用 parseInt 时，必须指定进制。
    ```
    parseInt(str, 10);
    ```
- [建议] 转换成 boolean 时，使用 !! 。
    ```
    !!num;
    ```
- [建议] number 去除小数点，使用 Math.floor / Math.round / Math.ceil ，不使用 parseInt。

#### 2.5 字符串
- [强制] [RULE089] 字符串开头和结束使用单引号 ' 。
- [建议] 使用 数组 或 + 拼接字符串。
    ```
    // 使用数组拼接字符串
    var str = [
        // 推荐换行开始并缩进开始第一个字符串, 对齐代码, 方便阅读.
        '<ul>',
            '<li>第一项</li>',
            '<li>第二项</li>',
        '</ul>'
    ].join('');
    
    // 使用 + 拼接字符串
    var str2 = '' // 建议第一个为空字符串, 第二个换行开始并缩进开始, 对齐代码, 方便阅读
        + '<ul>',
        +    '<li>第一项</li>',
        +    '<li>第二项</li>',
        + '</ul>';
    ```

#### 2.6 对象
- [强制] [RULE092] 使用对象字面量 {} 创建新 Object 。
    ```
    var obj = {};
    ```
- [强制] [RULE094] 对象创建时，如果一个对象的所有 属性 均可以不添加引号，则所有 属性 不得添加引号。
- [强制] 对象创建时，如果任何一个 属性 需要添加引号，则所有 属性 必须添加 ' 。
- [强制] [RULE095] 不允许修改和扩展任何原生对象和宿主对象的原型。
- [建议] 属性访问时，尽量使用 . 。
- [建议] for in 遍历对象时, 使用 hasOwnProperty 过滤掉原型中的属性。

#### 2.7 数组
- [强制] [RULE098] 使用数组字面量 [] 创建新数组，除非想要创建的是指定长度的数组。
- [强制] 遍历数组不使用 for in。用for()
- [建议] 不因为性能的原因自己实现数组排序功能，尽量使用数组的 sort 方法
- [建议] 清空数组使用 .length = 0

#### 2.8 函数


#### 2.9 面向对象
- [强制] 类的继承方案，实现时需要修正 constructor。
- [强制] 自定义事件的 事件名 必须全小写。
- [强制] 自定义事件只能有一个 event 参数。如果事件需要传递较多信息，应仔细设计事件对象。
- [建议] 设计自定义事件时，应考虑禁止默认行为。

#### 2.10 动态特性
##### 2.10.1 eval
- [强制] 避免使用直接 eval 函数。
- [建议] 尽量避免使用 eval 函数。

##### 2.10.2 动态执行代码



